{"version":3,"sources":["lib/configXmlParser.js"],"names":["path","require","fs","xml2js","ConfigXmlHelper","DEFAULT_SCHEME","module","exports","readPreferences","cordovaContext","configXml","read","console","warn","ulXmlPreferences","widget","length","xmlPreferences","hosts","constructHostsList","iosTeamId","getTeamIdPreference","androidPrefix","getAndroidPrefixPreference","hasOwnProperty","hostsList","xmlHostList","forEach","xmlElement","host","constructHostEntry","push","scheme","name","hostProperties"],"mappings":";;AAAA;;;AAGA,CAAC,YAAW;;AAEV,MAAIA,OAAOC,QAAQ,MAAR,CAAX;AAAA,MACEC,KAAKD,QAAQ,IAAR,CADP;AAAA,MAEEE,SAASF,QAAQ,QAAR,CAFX;AAAA,MAGEG,kBAAkBH,QAAQ,sBAAR,CAHpB;AAAA,MAIEI,iBAAiB,MAJnB;;AAMAC,SAAOC,OAAP,GAAiB;AACfC,qBAAiBA;AADF,GAAjB;;AAIA;;AAEA;;;;;;AAMA,WAASA,eAAT,CAAyBC,cAAzB,EAAyC;AACvC;AACA,QAAIC,YAAY,IAAIN,eAAJ,CAAoBK,cAApB,EAAoCE,IAApC,EAAhB;AACA,QAAID,aAAa,IAAjB,EAAuB;AACrBE,cAAQC,IAAR,CAAa,yFAAb;AACA,aAAO,IAAP;AACD;;AAED;AACA,QAAIC,mBAAmBJ,UAAUK,MAAV,CAAiB,eAAjB,CAAvB;AACA,QAAID,oBAAoB,IAApB,IAA4BA,iBAAiBE,MAAjB,IAA2B,CAA3D,EAA8D;AAC5DJ,cAAQC,IAAR,CAAa,gGAAb;AACA,aAAO,IAAP;AACD;;AAED,QAAII,iBAAiBH,iBAAiB,CAAjB,CAArB;;AAEA;AACA,QAAII,QAAQC,mBAAmBF,cAAnB,CAAZ;;AAEA;AACA,QAAIG,YAAYC,oBAAoBJ,cAApB,CAAhB;;AAEA;AACA,QAAIK,gBAAgBC,2BAA2BN,cAA3B,CAApB;;AAEA,WAAO;AACL,eAASC,KADJ;AAEL,mBAAaE,SAFR;AAGL,uBAAiBE;AAHZ,KAAP;AAKD;;AAED;;AAEA;;AAEA,WAASD,mBAAT,CAA6BJ,cAA7B,EAA6C;AAC3C,QAAIA,eAAeO,cAAf,CAA8B,aAA9B,CAAJ,EAAkD;AAChD,aAAOP,eAAe,aAAf,EAA8B,CAA9B,EAAiC,GAAjC,EAAsC,OAAtC,CAAP;AACD;;AAED,WAAO,IAAP;AACD;;AAED,WAASM,0BAAT,CAAoCN,cAApC,EAAoD;AAClD,QAAIA,eAAeO,cAAf,CAA8B,gBAA9B,CAAJ,EAAqD;AACnD,aAAOP,eAAe,gBAAf,EAAiC,CAAjC,EAAoC,GAApC,EAAyC,OAAzC,CAAP;AACD;;AAED,WAAO,IAAP;AACD;;AAED;;;;;;AAMA,WAASE,kBAAT,CAA4BF,cAA5B,EAA4C;AAC1C,QAAIQ,YAAY,EAAhB;;AAEA;AACA,QAAIC,cAAcT,eAAe,MAAf,CAAlB;AACA,QAAIS,eAAe,IAAf,IAAuBA,YAAYV,MAAZ,IAAsB,CAAjD,EAAoD;AAClD,aAAO,EAAP;AACD;;AAEDU,gBAAYC,OAAZ,CAAoB,UAASC,UAAT,EAAqB;AACvC,UAAIC,OAAOC,mBAAmBF,UAAnB,CAAX;AACA,UAAIC,IAAJ,EAAU;AACRJ,kBAAUM,IAAV,CAAeF,IAAf;AACD;AACF,KALD;;AAOA,WAAOJ,SAAP;AACD;;AAED;;;;;;AAMA,WAASK,kBAAT,CAA4BF,UAA5B,EAAwC;AACtC,QAAIC,OAAO;AACPG,cAAQ3B,cADD;AAEP4B,YAAM;AAFC,KAAX;AAAA,QAIEC,iBAAiBN,WAAW,GAAX,CAJnB;;AAMA,QAAIM,kBAAkB,IAAlB,IAA0BA,eAAelB,MAAf,IAAyB,CAAvD,EAA0D;AACxD,aAAO,IAAP;AACD;;AAED;AACAa,SAAKI,IAAL,GAAYC,eAAeD,IAA3B;;AAEA;AACA,QAAIC,eAAe,QAAf,KAA4B,IAAhC,EAAsC;AACpCL,WAAKG,MAAL,GAAcE,eAAeF,MAA7B;AACD;;AAED,WAAOH,IAAP;AACD;;AAED;AAED,CAhID","file":"lib/configXmlParser.js","sourcesContent":["/*\nParser for config.xml file. Read plugin-specific preferences (from <branch-config> tag) as JSON object.\n*/\n(function() {\n\n  var path = require('path'),\n    fs = require('fs'),\n    xml2js = require('xml2js'),\n    ConfigXmlHelper = require('./configXmlHelper.js'),\n    DEFAULT_SCHEME = 'http';\n\n  module.exports = {\n    readPreferences: readPreferences\n  };\n\n  // region Public API\n\n  /**\n   * Read plugin preferences from the config.xml file.\n   *\n   * @param {Object} cordovaContext - cordova context object\n   * @return {Array} list of host objects\n   */\n  function readPreferences(cordovaContext) {\n    // read data from projects root config.xml file\n    var configXml = new ConfigXmlHelper(cordovaContext).read();\n    if (configXml == null) {\n      console.warn('config.xml not found! Please, check that it exist\\'s in your project\\'s root directory.');\n      return null;\n    }\n\n    // look for data from the <branch-config> tag\n    var ulXmlPreferences = configXml.widget['branch-config'];\n    if (ulXmlPreferences == null || ulXmlPreferences.length == 0) {\n      console.warn('<branch-config> tag is not set in the config.xml. Universal Links plugin is not going to work.');\n      return null;\n    }\n\n    var xmlPreferences = ulXmlPreferences[0];\n\n    // read hosts\n    var hosts = constructHostsList(xmlPreferences);\n\n    // read ios team ID\n    var iosTeamId = getTeamIdPreference(xmlPreferences);\n\n    // read Android prefix\n    var androidPrefix = getAndroidPrefixPreference(xmlPreferences);\n\n    return {\n      'hosts': hosts,\n      'iosTeamId': iosTeamId,\n      'androidPrefix': androidPrefix\n    };\n  }\n\n  // endregion\n\n  // region Private API\n\n  function getTeamIdPreference(xmlPreferences) {\n    if (xmlPreferences.hasOwnProperty('ios-team-id')) {\n      return xmlPreferences['ios-team-id'][0]['$']['value'];\n    }\n\n    return null;\n  }\n\n  function getAndroidPrefixPreference(xmlPreferences) {\n    if (xmlPreferences.hasOwnProperty('android-prefix')) {\n      return xmlPreferences['android-prefix'][0]['$']['value'];\n    }\n\n    return null;\n  }\n\n  /**\n   * Construct list of host objects, defined in xml file.\n   *\n   * @param {Object} xmlPreferences - plugin preferences from config.xml as JSON object\n   * @return {Array} array of JSON objects, where each entry defines host data from config.xml.\n   */\n  function constructHostsList(xmlPreferences) {\n    var hostsList = [];\n\n    // look for defined hosts\n    var xmlHostList = xmlPreferences['host'];\n    if (xmlHostList == null || xmlHostList.length == 0) {\n      return [];\n    }\n\n    xmlHostList.forEach(function(xmlElement) {\n      var host = constructHostEntry(xmlElement);\n      if (host) {\n        hostsList.push(host);\n      }\n    });\n\n    return hostsList;\n  }\n\n  /**\n   * Construct host object from xml data.\n   *\n   * @param {Object} xmlElement - xml data to process.\n   * @return {Object} host entry as JSON object\n   */\n  function constructHostEntry(xmlElement) {\n    var host = {\n        scheme: DEFAULT_SCHEME,\n        name: ''\n      },\n      hostProperties = xmlElement['$'];\n\n    if (hostProperties == null || hostProperties.length == 0) {\n      return null;\n    }\n\n    // read host name\n    host.name = hostProperties.name;\n\n    // read scheme if defined\n    if (hostProperties['scheme'] != null) {\n      host.scheme = hostProperties.scheme;\n    }\n\n    return host;\n  }\n\n  // endregion\n\n})();\n"],"sourceRoot":"/source/"}