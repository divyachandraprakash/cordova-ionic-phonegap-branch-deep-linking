{"version":3,"sources":["iosBeforePrepareHook.js"],"names":["path","require","fs","ConfigXmlHelper","module","exports","ctx","run","projectRoot","opts","iosProjectFilePath","join","configXmlHelper","oldProjectName","getOldProjectName","newProjectName","getProjectName","length","console","log","oldEntitlementsFilePath","newEntitlementsFilePath","renameSync","err","warn","projectDir","files","projectName","readdirSync","some","fileName","extname","basename"],"mappings":";;AAAA;;;;;;AAMA,IAAIA,OAAOC,QAAQ,MAAR,CAAX;AAAA,IACEC,KAAKD,QAAQ,IAAR,CADP;AAAA,IAEEE,kBAAkBF,QAAQ,0BAAR,CAFpB;;AAIAG,OAAOC,OAAP,GAAiB,UAASC,GAAT,EAAc;AAC7BC,MAAID,GAAJ;AACD,CAFD;;AAIA;;;;;AAKA,SAASC,GAAT,CAAaD,GAAb,EAAkB;AAChB,MAAIE,cAAcF,IAAIG,IAAJ,CAASD,WAA3B;AAAA,MACEE,qBAAqBV,KAAKW,IAAL,CAAUH,WAAV,EAAuB,WAAvB,EAAoC,KAApC,CADvB;AAAA,MAEEI,kBAAkB,IAAIT,eAAJ,CAAoBG,GAApB,CAFpB;AAAA,MAGEO,iBAAiBC,kBAAkBJ,kBAAlB,CAHnB;AAAA,MAIEK,iBAAiBH,gBAAgBI,cAAhB,EAJnB;;AAMA;AACA,MAAIH,eAAeI,MAAf,GAAwB,CAAxB,IAA6BJ,mBAAmBE,cAApD,EAAoE;AAClE;AACD;;AAEDG,UAAQC,GAAR,CAAY,wDAAZ;;AAEA;AACA,MAAIC,0BAA0BpB,KAAKW,IAAL,CAAUD,kBAAV,EAA8BG,cAA9B,EAA8C,WAA9C,EAA2DA,iBAAiB,eAA5E,CAA9B;AAAA,MACEQ,0BAA0BrB,KAAKW,IAAL,CAAUD,kBAAV,EAA8BG,cAA9B,EAA8C,WAA9C,EAA2DE,iBAAiB,eAA5E,CAD5B;;AAGA,MAAI;AACFb,OAAGoB,UAAH,CAAcF,uBAAd,EAAuCC,uBAAvC;AACD,GAFD,CAEE,OAAOE,GAAP,EAAY;AACZL,YAAQM,IAAR,CAAa,sCAAb;AACAN,YAAQM,IAAR,CAAaD,GAAb;AACD;AACF;;AAED;;AAEA;;;;;;;AAOA,SAAST,iBAAT,CAA2BW,UAA3B,EAAuC;AACrC,MAAIC,QAAQ,EAAZ;AAAA,MACEC,cAAc,EADhB;;AAGA,MAAI;AACFD,YAAQxB,GAAG0B,WAAH,CAAeH,UAAf,CAAR;AACD,GAFD,CAEE,OAAOF,GAAP,EAAY;AACZ,WAAO,EAAP;AACD;;AAED;AACAG,QAAMG,IAAN,CAAW,UAASC,QAAT,EAAmB;AAC5B,QAAI9B,KAAK+B,OAAL,CAAaD,QAAb,MAA2B,YAA/B,EAA6C;AAC3CH,oBAAc3B,KAAKgC,QAAL,CAAcF,QAAd,EAAwB,YAAxB,CAAd;AACA,aAAO,IAAP;AACD;;AAED,WAAO,KAAP;AACD,GAPD;;AASA,SAAOH,WAAP;AACD;;AAED","file":"iosBeforePrepareHook.js","sourcesContent":["/*\nHook executed before the 'prepare' stage. Only for iOS project.\nIt will check if project name has changed. If so - it will change the name of the .entitlements file to remove that file duplicates.\nIf file name has no changed - hook would not do anything.\n*/\n\nvar path = require('path'),\n  fs = require('fs'),\n  ConfigXmlHelper = require('./lib/configXmlHelper.js');\n\nmodule.exports = function(ctx) {\n  run(ctx);\n};\n\n/**\n * Run the hook logic.\n *\n * @param {Object} ctx - cordova context object\n */\nfunction run(ctx) {\n  var projectRoot = ctx.opts.projectRoot,\n    iosProjectFilePath = path.join(projectRoot, 'platforms', 'ios'),\n    configXmlHelper = new ConfigXmlHelper(ctx),\n    oldProjectName = getOldProjectName(iosProjectFilePath),\n    newProjectName = configXmlHelper.getProjectName();\n\n  // if name has not changed - do nothing\n  if (oldProjectName.length > 0 && oldProjectName === newProjectName) {\n    return;\n  }\n\n  console.log('Project name has changed. Renaming .entitlements file.');\n\n  // if it does - rename it\n  var oldEntitlementsFilePath = path.join(iosProjectFilePath, oldProjectName, 'Resources', oldProjectName + '.entitlements'),\n    newEntitlementsFilePath = path.join(iosProjectFilePath, oldProjectName, 'Resources', newProjectName + '.entitlements');\n\n  try {\n    fs.renameSync(oldEntitlementsFilePath, newEntitlementsFilePath);\n  } catch (err) {\n    console.warn('Failed to rename .entitlements file.');\n    console.warn(err);\n  }\n}\n\n// region Private API\n\n/**\n * Get old name of the project.\n * Name is detected by the name of the .xcodeproj file.\n *\n * @param {String} projectDir absolute path to ios project directory\n * @return {String} old project name\n */\nfunction getOldProjectName(projectDir) {\n  var files = [],\n    projectName = '';\n\n  try {\n    files = fs.readdirSync(projectDir);\n  } catch (err) {\n    return '';\n  }\n\n  // find file with .xcodeproj extension, use it as an old project name\n  files.some(function(fileName) {\n    if (path.extname(fileName) === '.xcodeproj') {\n      projectName = path.basename(fileName, '.xcodeproj');\n      return true;\n    }\n\n    return false;\n  });\n\n  return projectName;\n}\n\n// endregion\n"],"sourceRoot":"/source/"}